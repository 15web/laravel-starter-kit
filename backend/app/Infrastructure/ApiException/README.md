# Обработка ошибок API

Модуль перехватывает все исключения приложения и приводит их к единому виду.

## Перечень возможных ошибок
- enum `\App\Contract\Error`
- http code `\App\Infrastructure\ApiException\Http\StatusCode`

## Ошибки приложения

Чтобы бросить исключение из своего кода, 
следует использовать фабричные методы класса `\App\Infrastructure\ApiException\ApiException`.
Они требуют:
- сообщение
- enum ошибки, описанный в `\App\Contract\Error`
- предыдущее исключение (если оно есть). Очень желательно передать этот аргумент, 
так как это значительно облегчит отладку. В логи попадёт стек исключений и можно будет добраться до сути.

Фабричные методы создают исключения с соответствующим `http status code`:
- Ошибки в логике (валидация, бизнес-правила) с кодом `200` создаются методом `createDomainException`
- Ошибки имеющие определённый код `400`, `404` создаются соответствующими методами: `createBadRequestException`, 
`createNotFoundException`

## Ошибки фреймворка

Фреймворк выбрасывает разные ошибки, например `404` в маршрутизации.
Чтобы привести их к единому виду, модуль перехватывает все возможные `Throwable` и наследует класс `laravel` 
для работы с исключениями `\App\Infrastructure\ApiException\Handler\Handler::render`.

## Расширение функционала

- Для добавления ошибки в логике: 
  - дополнить `\App\Contract\Error` соответствующим перечислением с префиксом `my_module_`
- Для добавления ошибки имеющей определённый код:
  - дополнить `\App\Contract\Error` соответствующим перечислением с префиксом `general_`
  - дополнить `\App\Infrastructure\ApiException\Http\StatusCode` соответствующим перечислением с кодом ошибки
  - добавить фабричный метод по аналогии с `createBadRequestException` или `createNotFoundException`
- Для обработки ошибок фреймворка:
  - (при необходимости) добавить ошибку, имеющую определённый код, как описано в предыдущем пункте.
  - добавить условие с ранним возвратом в `\App\Infrastructure\ApiException\Handler\Handler::handleSpecificException`
